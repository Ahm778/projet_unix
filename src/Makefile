# Makefile pour le projet Communication Client/Serveur par Tubes NommÃ©s
# Auteurs: [Votre Nom]
# Date: $(shell date +%Y-%m-%d)

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g
LDFLAGS = 

# Fichiers sources
SERVER_SRC = serveur.c
CLIENT_SRC = client.c
COMMON_HEADERS = serv_cli_fifo.h Handlers_Serv.h Handlers_Cli.h

# ExÃ©cutables
SERVER_EXE = serveur
CLIENT_EXE = client

# Cible par dÃ©faut
all: $(SERVER_EXE) $(CLIENT_EXE) documentation

# Compilation du serveur
$(SERVER_EXE): $(SERVER_SRC) $(COMMON_HEADERS)
	@echo "ðŸ”¨ Compilation du serveur..."
	$(CC) $(CFLAGS) -o $(SERVER_EXE) $(SERVER_SRC) $(LDFLAGS)
	@echo "âœ… Serveur compilÃ©: ./$(SERVER_EXE)"

# Compilation du client
$(CLIENT_EXE): $(CLIENT_SRC) $(COMMON_HEADERS)
	@echo "ðŸ”¨ Compilation du client..."
	$(CC) $(CFLAGS) -o $(CLIENT_EXE) $(CLIENT_SRC) $(LDFLAGS)
	@echo "âœ… Client compilÃ©: ./$(CLIENT_EXE)"

# Nettoyage
clean:
	@echo "ðŸ§¹ Nettoyage..."
	rm -f $(SERVER_EXE) $(CLIENT_EXE) fifo1 fifo2 *.o
	@echo "âœ… Nettoyage terminÃ©"

# Installation
install: all
	@echo "ðŸš€ Installation terminÃ©e!"
	@echo "ðŸ“‹ Utilisation:"
	@echo "   Terminal 1: ./$(SERVER_EXE)"
	@echo "   Terminal 2: ./$(CLIENT_EXE)"

# Documentation
documentation:
	@echo "ðŸ“– GÃ©nÃ©ration de la documentation..."
	@echo "=== PROJET COMMUNICATION CLIENT/SERVEUR ===" > README.txt
	@echo "Date: $(shell date)" >> README.txt
	@echo "" >> README.txt
	@echo "FICHIERS:" >> README.txt
	@echo "- serv_cli_fifo.h: DÃ©finitions communes" >> README.txt
	@echo "- Handlers_Serv.h: Gestionnaires serveur" >> README.txt
	@echo "- Handlers_Cli.h: Gestionnaires client" >> README.txt
	@echo "- serveur.c: Programme serveur" >> README.txt
	@echo "- client.c: Programme client" >> README.txt
	@echo "- Makefile: Compilation automatique" >> README.txt
	@echo "" >> README.txt
	@echo "UTILISATION:" >> README.txt
	@echo "1. make          # Compiler" >> README.txt
	@echo "2. ./serveur     # DÃ©marrer serveur" >> README.txt
	@echo "3. ./client      # DÃ©marrer client" >> README.txt
	@echo "4. make clean    # Nettoyer" >> README.txt
	@echo "âœ… Documentation gÃ©nÃ©rÃ©e: README.txt"

# Test automatique
test: all
	@echo "ðŸ§ª Test automatique..."
	@./serveur &
	@sleep 2
	@echo "Test client 1..." && ./client < test_input.txt
	@killall serveur 2>/dev/null || true
	@echo "âœ… Test terminÃ©"

# Archive pour remise
archive: clean documentation
	@echo "ðŸ“¦ CrÃ©ation archive..."
	@tar -czf projet_unix_$(shell date +%Y%m%d_%H%M).tar.gz \
		$(SERVER_SRC) $(CLIENT_SRC) $(COMMON_HEADERS) \
		Makefile README.txt
	@echo "âœ… Archive crÃ©Ã©e: projet_unix_$(shell date +%Y%m%d_%H%M).tar.gz"

.PHONY: all clean install documentation test archive